{% extends "base.html" %}

{% block title %}
{% if session.get('preferred_language') == 'english' %}
Error - Store
{% else %}
שגיאה - חנות
{% endif %}
{% endblock %}

{% block content %}
<div class="container">
    <div class="row justify-content-center">
        <div class="col-lg-6 col-md-8">
            <div class="mb-4">
                <i class="bi bi-exclamation-triangle-fill text-danger" style="font-size: 4rem;"></i>
            </div>

            <!-- Error Title -->
            <h1 class="h2 mb-3">
                {% if session.get('preferred_language') == 'english' %}
                Oops! Something went wrong
                {% else %}
                אופס! משהו השתבש
                {% endif %}
            </h1>

            <!-- Error Message -->
            <div class="card mb-4">
                <div class="card-body">
                    <p class="card-text">
                        {% if error_message %}
                        {{ error_message }}
                        {% else %}
                        {% if session.get('preferred_language') == 'english' %}
                        We encountered an unexpected error. Please try again later.
                        {% else %}
                        נתקלנו בשגיאה לא צפויה. אנא נסה שוב מאוחר יותר.
                        {% endif %}
                        {% endif %}
                    </p>
                </div>
            </div>

            <!-- Error Code -->
            {% if error_code %}
            <p class="text-muted mb-4">
                <small>
                    {% if session.get('preferred_language') == 'english' %}
                    Error Code: {{ error_code }}
                    {% else %}
                    קוד שגיאה: {{ error_code }}
                    {% endif %}
                </small>
            </p>
            {% endif %}

            <!-- Action Buttons -->
            <div class="d-flex flex-column flex-sm-row gap-3 justify-content-center">
                <button onclick="history.back()" class="btn btn-outline-primary">
                    <i class="bi bi-arrow-left me-2"></i>
                    {% if session.get('preferred_language') == 'english' %}
                    Go Back
                    {% else %}
                    חזור אחורה
                    {% endif %}
                </button>
                <a href="{{ url_for('main.index') }}" class="btn btn-primary">
                    <i class="bi bi-house me-2"></i>
                    {% if session.get('preferred_language') == 'english' %}
                    Go Home
                    {% else %}
                    לעמוד הבית
                    {% endif %}
                </a>
                <button onclick="location.reload()" class="btn btn-outline-success">
                    <i class="bi bi-arrow-clockwise me-2"></i>
                    {% if session.get('preferred_language') == 'english' %}
                    Try Again
                    {% else %}
                    נסה שוב
                    {% endif %}
                </button>
            </div>
        </div>
    </div>
</div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Auto-retry after 30 seconds if no user interaction
        let retryTimer;
        let timeLeft = 30;

        function startRetryTimer() {
            const retryBtn = document.querySelector('button[onclick="location.reload()"]');
            if (retryBtn) {
                retryTimer = setInterval(() => {
                    timeLeft--;
                    retryBtn.innerHTML = `<i class="bi bi-arrow-clockwise me-2"></i>{% if session.get('preferred_language') == 'english' %}Try Again (${timeLeft}s){% else %}נסה שוב (${timeLeft}ש){% endif %}`;

                    if (timeLeft <= 0) {
                        clearInterval(retryTimer);
                        location.reload();
                    }
                }, 1000);
            }
        }

        // Cancel retry timer on any user interaction
        function cancelRetryTimer() {
            if (retryTimer) {
                clearInterval(retryTimer);
                const retryBtn = document.querySelector('button[onclick="location.reload()"]');
                if (retryBtn) {
                    retryBtn.innerHTML = '<i class="bi bi-arrow-clockwise me-2"></i>{% if session.get("preferred_language") == "english" %}Try Again{% else %}נסה שוב{% endif %}';
                }
            }
        }

        // Start auto-retry timer
        startRetryTimer();

        // Cancel timer on user interaction
        document.addEventListener('click', cancelRetryTimer);
        document.addEventListener('keydown', cancelRetryTimer);
        document.addEventListener('scroll', cancelRetryTimer);
    });
</script>
{% endblock %}