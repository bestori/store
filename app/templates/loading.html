<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loading Products - Cable Tray Store</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .loading-container {
            background: white;
            border-radius: 20px;
            padding: 3rem;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            text-align: center;
            max-width: 500px;
            width: 90%;
        }
        
        .loading-icon {
            font-size: 4rem;
            color: #667eea;
            margin-bottom: 2rem;
            animation: spin 2s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading-title {
            font-size: 2rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 1rem;
        }
        
        .loading-subtitle {
            font-size: 1.1rem;
            color: #666;
            margin-bottom: 2rem;
        }
        
        .progress-container {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 1rem;
            margin-bottom: 2rem;
        }
        
        .progress {
            height: 8px;
            border-radius: 4px;
            background: #e9ecef;
        }
        
        .progress-bar {
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 4px;
            transition: width 0.3s ease;
        }
        
        .loading-steps {
            text-align: left;
            margin-top: 2rem;
        }
        
        .loading-step {
            display: flex;
            align-items: center;
            margin-bottom: 0.8rem;
            font-size: 0.95rem;
            color: #666;
        }
        
        .loading-step.active {
            color: #667eea;
            font-weight: 600;
        }
        
        .loading-step.completed {
            color: #28a745;
        }
        
        .step-icon {
            margin-right: 0.8rem;
            font-size: 1.2rem;
        }
        
        .loading-message {
            font-size: 0.9rem;
            color: #888;
            margin-top: 1.5rem;
            font-style: italic;
        }
        
        .rtl {
            direction: rtl;
            text-align: right;
        }
        
        .hebrew-text {
            font-family: 'Arial', 'Helvetica', sans-serif;
        }
    </style>
</head>
<body>
    <div class="loading-container">
        <div class="loading-icon">
            <i class="bi bi-gear-fill"></i>
        </div>
        
        <div class="loading-title">
            <span class="hebrew-text">טוען מוצרים</span>
            <br>
            Loading Products
        </div>
        
        <div class="loading-subtitle">
            <span class="hebrew-text">אנא המתן בזמן שאנחנו טוענים את הקטלוג מהקבצים</span>
            <br>
            Please wait while we load the catalog from Excel files
        </div>
        
        <div class="progress-container">
            <div class="progress">
                <div class="progress-bar" role="progressbar" style="width: 0%" id="progressBar"></div>
            </div>
            <div class="mt-2">
                <small class="text-muted" id="progressText">Initializing...</small>
            </div>
        </div>
        
        <div class="loading-steps">
            <div class="loading-step" id="step1">
                <i class="bi bi-file-earmark-excel step-icon"></i>
                <span class="hebrew-text">קריאת קבצי Excel</span> / Reading Excel files
            </div>
            <div class="loading-step" id="step2">
                <i class="bi bi-database step-icon"></i>
                <span class="hebrew-text">חיבור למסד הנתונים</span> / Connecting to database
            </div>
            <div class="loading-step" id="step3">
                <i class="bi bi-arrow-down-circle step-icon"></i>
                <span class="hebrew-text">טעינת מוצרים למסד הנתונים</span> / Loading products to database
            </div>
            <div class="loading-step" id="step4">
                <i class="bi bi-check-circle step-icon"></i>
                <span class="hebrew-text">סיום הטעינה</span> / Finishing loading
            </div>
        </div>
        
        <div class="loading-message" id="loadingMessage">
            <span class="hebrew-text">זה עשוי לקחת כמה שניות...</span>
            <br>
            This may take a few seconds...
        </div>
    </div>

    <script>
        // Simulate loading progress
        let currentStep = 0;
        const steps = [
            { id: 'step1', text: 'Reading Excel files...', progress: 25 },
            { id: 'step2', text: 'Connecting to database...', progress: 50 },
            { id: 'step3', text: 'Loading products to database...', progress: 75 },
            { id: 'step4', text: 'Finishing loading...', progress: 100 }
        ];
        
        function updateProgress() {
            if (currentStep < steps.length) {
                const step = steps[currentStep];
                
                // Mark previous steps as completed
                for (let i = 0; i < currentStep; i++) {
                    const prevStep = document.getElementById(steps[i].id);
                    prevStep.classList.remove('active');
                    prevStep.classList.add('completed');
                    prevStep.querySelector('.step-icon').className = 'bi bi-check-circle-fill step-icon';
                }
                
                // Mark current step as active
                const currentStepEl = document.getElementById(step.id);
                currentStepEl.classList.add('active');
                currentStepEl.querySelector('.step-icon').className = 'bi bi-arrow-clockwise step-icon';
                
                // Update progress bar
                document.getElementById('progressBar').style.width = step.progress + '%';
                document.getElementById('progressText').textContent = step.text;
                
                currentStep++;
                
                // Continue to next step after delay
                setTimeout(updateProgress, 2000);
            } else {
                // All steps completed, redirect to main app
                setTimeout(() => {
                    window.location.href = '/';
                }, 1000);
            }
        }
        
        // Check actual loading status from server
        function checkLoadingStatus() {
            fetch('/api/v1/loading-status')
                .then(response => response.json())
                .then(data => {
                    if (data.loaded) {
                        // Loading complete, redirect to main app
                        window.location.href = '/';
                    } else {
                        // Still loading, check again
                        setTimeout(checkLoadingStatus, 1000);
                    }
                })
                .catch(error => {
                    console.error('Error checking loading status:', error);
                    // Fallback to simulated progress
                    updateProgress();
                });
        }
        
        // Start checking loading status
        checkLoadingStatus();
    </script>
</body>
</html>